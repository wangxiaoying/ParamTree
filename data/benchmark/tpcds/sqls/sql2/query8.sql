-- start query 1 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '19957','14189','96500','72532','69987','22545',
                          '63668','69671','42200','31685','92151',
                          '62684','41858','86085','35975','57147',
                          '61008','43459','31003','85225','98002',
                          '22692','21772','64877','10210','18220',
                          '76199','85064','33633','39463','39789',
                          '10453','15136','43877','33974','10346',
                          '78312','44652','10937','67643','25746',
                          '12926','79140','40545','51785','73491',
                          '93788','94536','20724','53507','66356',
                          '53810','60764','15889','81337','18594',
                          '48179','44437','17346','31807','15487',
                          '46407','26516','86049','27911','44390',
                          '94189','10871','22810','49892','59045',
                          '69688','66637','29163','64084','37969',
                          '25507','88281','95204','14228','33233',
                          '70189','82890','12205','49388','14744',
                          '16564','17162','13709','82052','54377',
                          '32247','19011','50118','21576','26380',
                          '33791','12901','45256','46289','70076',
                          '89795','41418','51541','80980','55070',
                          '71271','44795','60520','26144','69572',
                          '48110','85844','74704','66702','78950',
                          '77085','90799','23574','39555','30521',
                          '87115','37417','16864','62791','66777',
                          '34580','99061','23239','66385','92238',
                          '57084','73835','58362','81535','97643',
                          '61391','59425','83408','56601','20695',
                          '20323','73991','74785','51490','19581',
                          '38469','17712','94671','84013','45945',
                          '38550','48191','97420','26909','16620',
                          '94579','41159','64164','28606','15139',
                          '69037','82193','10029','47444','64542',
                          '32441','55689','91086','73058','45103',
                          '99634','72727','18272','33811','69181',
                          '32069','16260','63600','70024','94359',
                          '64435','42700','33114','65257','32203',
                          '53346','18720','49746','37406','56289',
                          '27285','58186','56658','42693','27069',
                          '74777','85038','69359','39398','26893',
                          '70944','53990','57146','31738','21910',
                          '25755','73581','33997','28795','19526',
                          '15484','51651','98774','33134','17785',
                          '49789','33108','37270','14471','73929',
                          '20093','65991','25553','23088','69820',
                          '99069','15263','21113','48614','64098',
                          '59832','99057','74606','23913','56168',
                          '78467','79576','13113','24451','69400',
                          '33454','40627','57659','11927','59729',
                          '79706','98999','97943','49122','86400',
                          '22819','87970','29856','50180','12888',
                          '96760','77816','37532','16305','58679',
                          '94110','78591','57498','54261','97253',
                          '50347','86521','35310','82799','90988',
                          '67684','58401','26545','28212','71195',
                          '59650','66115','61101','10301','87583',
                          '94365','67561','91948','18566','13590',
                          '19508','67271','45110','15399','72772',
                          '13153','90177','90399','15719','10726',
                          '37825','84094','84964','60647','16460',
                          '27921','40616','88107','22191','43134',
                          '38090','75050','30914','37797','73611',
                          '11038','77468','85684','75889','79205',
                          '12517','13423','45318','67582','23612',
                          '37828','41060','51183','28173','20094',
                          '28722','28748','98416','14116','27851',
                          '89747','57755','12783','38950','73538',
                          '80502','23502','71406','44845','87314',
                          '41814','25359','40871','41065','44041',
                          '26405','36329','34607','34234','33258',
                          '26582','53553','39074','25733','17223',
                          '41650','75397','53812','16785','89480',
                          '52821','43054','72958','61864','10244',
                          '99651','37738','83796','51773','25300',
                          '68588','67251','88771','12764','29446',
                          '68913','27861','82273','16618','12877',
                          '25560','32789','35369','14794','14290',
                          '33036','80407','57801','35394','33016',
                          '29838','14007','84710','28326','15650',
                          '63385','97987','51152','65149')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;

-- end query 1 in stream 0 using template query8.tpl
