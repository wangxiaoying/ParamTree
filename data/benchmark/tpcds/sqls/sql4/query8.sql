-- start query 1 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '90656','89389','14795','40986','48427','35089',
                          '10957','56219','74399','92769','94114',
                          '68366','93634','20136','41588','37247',
                          '22015','13874','83344','25587','65117',
                          '13811','95387','75254','99489','26439',
                          '52397','75626','12997','40296','36461',
                          '53786','60402','27069','57947','96886',
                          '56623','85656','83266','14507','37869',
                          '47032','16706','68437','54647','89704',
                          '64877','25437','57130','81782','39064',
                          '47266','16833','28130','69026','15961',
                          '18850','88573','39463','75946','45134',
                          '71371','71174','67069','65195','13766',
                          '56838','89633','41972','47258','48830',
                          '40954','80894','41112','28167','25840',
                          '85312','97783','96760','14979','25520',
                          '53121','45573','69662','95128','10802',
                          '24004','24323','26864','16625','87969',
                          '88201','93788','42658','34048','85324',
                          '89869','20408','53507','15716','48711',
                          '11581','49921','71242','60764','80130',
                          '61094','40024','11883','35827','62688',
                          '25877','48179','12011','44437','58463',
                          '97439','15821','10220','46499','80082',
                          '62931','51722','28176','19841','18646',
                          '65512','98121','43885','30202','44390',
                          '22404','94189','77834','45060','11638',
                          '87942','32613','46867','14820','59045',
                          '98384','82940','69387','61047','35514',
                          '82561','50774','42892','46541','88242',
                          '30971','86381','51328','88281','47361',
                          '89157','14090','28327','41823','39067',
                          '33354','69606','73029','42180','97010',
                          '61234','40280','88524','72419','20905',
                          '80636','45453','33673','33786','44714',
                          '33454','78674','18242','63824','59387',
                          '35222','90148','51807','69695','19541',
                          '96691','18600','14643','31776','20123',
                          '50579','67811','34871','74434','15960',
                          '23215','61183','20017','21249','70076',
                          '26089','55287','95600','33048','53614',
                          '97386','72839','63592','53942','20919',
                          '91248','99654','59942','66118','39575',
                          '38133','69815','33751','32501','11526',
                          '44730','54515','32621','63411','66110',
                          '92203','42227','66702','24264','34548',
                          '95563','46264','35937','91374','25798',
                          '31700','68976','36335','12695','31780',
                          '50495','13774','64986','37417','61216',
                          '16864','55674','35703','41998','29832',
                          '90553','82292','44615','26079','25750',
                          '72764','55631','96125','38755','60129',
                          '26160','63929','40721','59382','76451',
                          '81461','69173','76949','63569','88328',
                          '49160','41667','93378','38963','88526',
                          '52080','29876','54699','13258','64497',
                          '15649','36797','45853','73991','53627',
                          '87247','83196','51490','78645','51896',
                          '56054','41348','26339','58416','94820',
                          '36369','44689','69927','99764','24183',
                          '73687','63199','14171','91601','24483',
                          '13493','37305','94771','17813','81680',
                          '37239','54935','99011','19553','22942',
                          '79429','66136','37866','82893','24750',
                          '24806','84432','39685','17233','77755',
                          '22886','47495','28413','80706','98710',
                          '85846','90635','82176','43786','85838',
                          '85370','75841','31748','73238','99860',
                          '54365','22166','30891','91135','94012',
                          '34509','79158','58756','27088','88514',
                          '43163','13433','46114','27074','47505',
                          '84135','83252','70024','25354','94359',
                          '20657','70022','89241','66281','44603',
                          '39827','90136','26220','70875','71177',
                          '49985','46052','37988','24843','58738',
                          '79131','52074','78115','31762','82952',
                          '41119','36185','36215','22535','81842',
                          '70274','60813','75451','62702','89192',
                          '38742','72944','60204','62803','67173',
                          '45121','91775','39398','35785')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;

-- end query 1 in stream 0 using template query8.tpl
